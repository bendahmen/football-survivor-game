<!-- templates/pool_detail.html -->
{% extends 'base.html' %}

{% block content %}
<h2>{{ pool.name }}</h2>

{% if not player_entry %}
    <div style="background: #fff3cd; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <p>You are not in this pool yet.</p>
        <form method="post" action="{% url 'survivor:join_pool' pool.id %}" style="margin-top: 1rem;">
            {% csrf_token %}
            <button type="submit" style="padding: 0.5rem 1rem; background: #2e7d32; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Join Pool
            </button>
        </form>
    </div>
{% elif player_entry.is_eliminated %}
    <div style="background: #ffcdd2; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <p>You were eliminated in Matchday {{ player_entry.eliminated_matchday.number }}</p>
    </div>
{% else %}
    {% if next_matchday %}
    <div style="background: white; padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
        <h3>Make Your Pick for Matchday {{ next_matchday.number }}</h3>
        <p>Deadline: {{ next_matchday.start_date }}</p>
        
        {% if current_pick %}
        <p style="background: #c8e6c9; padding: 0.5rem; border-radius: 4px; margin: 1rem 0;">
            Current pick: <strong>{{ current_pick.team.name }}</strong>
        </p>
        {% endif %}
        
        <form method="post" action="{% url 'survivor:make_pick' pool.id %}">
            {% csrf_token %}
            <input type="hidden" name="matchday_id" value="{{ next_matchday.id }}">
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; margin: 1rem 0;">
                {% for team_info in teams %}
                <label style="display: block; padding: 0.5rem; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;
                              {% if not team_info.available %}opacity: 0.5; pointer-events: none;{% endif %}">
                    <input type="radio" name="team_id" value="{{ team_info.team.id }}"
                           {% if not team_info.available %}disabled{% endif %}
                           {% if current_pick and current_pick.team.id == team_info.team.id %}checked{% endif %}>
                    {{ team_info.team.short_name }}
                    {% if team_info.pick_count > 0 %}
                    <span style="color: #ff9800;">({{ team_info.pick_count }})</span>
                    {% endif %}
                </label>
                {% endfor %}
            </div>
            
            <button type="submit" style="padding: 0.5rem 1rem; background: #2e7d32; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Save Pick
            </button>
        </form>
    </div>
    {% endif %}
{% endif %}

<div style="background: white; padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
    <h3>Pool Standings</h3>
    <table style="width: 100%; margin-top: 1rem;">
        <thead>
            <tr style="text-align: left; border-bottom: 2px solid #ddd;">
                <th style="padding: 0.5rem;">Player</th>
                <th style="padding: 0.5rem;">Status</th>
                <th style="padding: 0.5rem;">Eliminated</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in all_entries %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 0.5rem;">{{ entry.user.username }}</td>
                <td style="padding: 0.5rem;">
                    {% if entry.is_eliminated %}
                    <span style="color: #c62828;">Eliminated</span>
                    {% else %}
                    <span style="color: #2e7d32;">Active</span>
                    {% endif %}
                </td>
                <td style="padding: 0.5rem;">
                    {% if entry.eliminated_matchday %}
                    Matchday {{ entry.eliminated_matchday.number }}
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}